{% extends "base.html" %}
{% block content %}
<h1>Profile</h1>
<img src="{{ user.avatar.url }}" alt="Avatar"> 
<p>{{ user.username }}</p> 
<p>{{ user.first_name }} {{ user.last_name }}</p>
{% if user.bio.Null%}
{% elif user.bio %}
    <p>Bio: {{ user.bio }}</p>
{% endif %}
<p>Email: {{ user.email }}</p>

<p>Registration Date: {{ user.created_at }}</p>
<p><a href="{% url 'followings' user.username %}">Followings: {{ user.subscriptions_count }}</a></p>
<p><a href="{% url 'followers' user.username %}">Followers: {{ user.subscribers_count }}</a></p>
<p>Country: {{ user.country.name }}</p>

<a href="{% url 'edit-profile' %}">Edit Profile</a>



<h2>Tweets:</h2>
    <form method="GET" action="{% url 'profile' %}">
        {% csrf_token %}
        <select name="sort_by">
            <option value="Newest" {% if request.GET.sort_by == 'Newest' %}selected{% endif %}>Date</option>
            <option value="Likes" {% if request.GET.sort_by == 'Likes' %}selected{% endif %}>Likes</option>
        </select>
        <button type="submit">Sort</button>
    </form>
    {% for tweet in tweets %}
    <div class="tweet">
        <p>Author: {{ tweet.author.first_name }} {{ tweet.author.last_name }} <a href="{% url 'profile' %}">@{{ tweet.author.username }}</a></p>
        <p>Date: {{ tweet.created_at }}</p>
        <a href="{% url 'get-tweet' tweet.id %}">{{ tweet.content }}</a>
        <li>
            <form action="{% url 'like_tweet' tweet_id=tweet.id %}" method="POST">
                {% csrf_token %}
                <button type="submit" class="like-button">Like</button> {{ tweet.likes_count }}
            </form>
        </li>
        <p>Retweets: {{ tweet.retweets_count }}</p>
        <p>Comments: {{ tweet.comments_count }}</p>
        <p>Tags:
            {% for tag in tweet.tags.all %}
                {{ tag.name }}
            {% endfor %}
        </p> 
    </div>
    {% endfor %}
    {% if tweets.has_previous or tweets.has_next %}
        <div class="pagination">
            {% if tweets.has_previous %}
                <a href="?sort_by={{ request.GET.sort_by }}&page={{ tweets.previous_page_number }}">Previous</a>
            {% endif %}
            
            {% for num in tweets.paginator.page_range %}
                {% if num == tweets.number %}
                    <span class="current-page">{{ num }}</span>
                {% else %}
                    <a href="?sort_by={{ request.GET.sort_by }}&page={{ num }}">{{ num }}</a>
                {% endif %}
            {% endfor %}
            
            {% if tweets.has_next %}
                <a href="?sort_by={{ request.GET.sort_by }}&page={{ tweets.next_page_number }}">Next</a>
            {% endif %}
        </div>
    {% endif %}
{% endblock %}
